<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Удаление лишних слов для Анки</title>
<body>
<noscript>
 Для работы меню включите скрипты! <br>
 please turn on javascripts!
</noscript>
<style>
@import url('bootstrap.min.css');
body {font-size:22px;background-color:azure;padding:10px;}
a {outline: none; font-weight: 700}
ul li a[aria-controls="profile"]:hover{color:red}
.ot2 {margin: 2px 1px}
span {color:darkblue}
#id_p0 {margin-left: 10px}
#id_p3 {max-width:100%; width:auto}
#id_p5,#id_p6 {font-size: 20px}
hr {margin-top: 5px; margin-bottom: 5px}
.mag {border-top: 1px solid #428bca}
textarea {width:100%;background-color:mintcream;}
#id_b1,#id_b2 {float:right}
</style>
<script src='jquery.min.js'></script>
<script src='bootstrap.min.js'></script>
<!-- Навигация -->
<ul class="nav nav-tabs" role="tablist">
 <li class="active"><a href="#tem" aria-controls="tem" role="tab" data-toggle="tab" title="Всякая лабуда">начало</a></li>
 <li><a id="id_spisok" href="#tem1" aria-controls="tem1" role="tab" data-toggle="tab" title="Полный список слов">список</a></li>
 <li><a href="#tem2" aria-controls="tem2" role="tab" data-toggle="tab" title="Тут можно удалить лишнее" onclick="cards();">карточки</a></li>
</ul>

<!-- Содержимое вкладок -->
<div class="tab-content">

<div role="tabpanel" class="tab-pane fade in active" id="tem" align="">
 <div class="panel panel-primary">
  <div class="panel-heading">
   <h1>Вступление и Описание</h1>
  </div>
  <div class="panel-body">
   <h2>ИНСТРУКЦИЯ КАК ДОБАВЛЯТЬ В АНКИ</h2>
   Если импортировать (apkg) то тип записи создатся сам, но можно сделать его вручную - 4 поля: слово, перевод, ассоциация и похожие. Потом при импорте выбрать разделитель (|) и этот тип записи, там ГДЕ ПРОВЕРЯТЬ (тип записи и колоды) иначе не все добавятся! там по умолчанию стоит неправильно! <br>
   Можно потом ещё добавить звуки и картинки, и подробный перевод и примеры на англ. Они есть в других колодах и на сайтах. Хорошие картинки я видел на одном сайте и приложении, но там слова всем известные или ненужные редкие, а от плохих картинок толку мало, они должны удивлять или смешить и понятно изображать предмет, глагол или ФА. Списки иногда меняются так что сами форматируйте здесь.<br>
   <hr>
   <h2>Приложение АНКИ-дроид</h2>
   Плюсы - сразу есть импорт экспорт без реги! С регой можно скачать из общего хранилища (видно все, но искать трудно) и оставить отзыв! Но не дают качать много, лучше качать с др.сайтов и импортировать, на ВК есть итд. Есть интервальное повторение. Можно красиво оформить карточку через html теги, много полей. берём текст-список и в поле, жмем кнопки и получится красиво, но потом надо зайти в карточку - нажать редактировать- внизу - карточка - стили и вставить туда стили для ссылок, жирных и курсива или свои пишите, для конкретного экрана нужны свои размеры и стили, на всех сделать красиво нереально<br>
   ==========<br>
   .card {font-size: 28px;}<br>
   a {color:darkblue}<br>
   i {color:red}<br>
   .hr1 {border-top:1px solid #428bca; margin-top:3px;margin-bottom:3px;}<br>
   .hr2 {border-top:2px solid green;   margin-top:3px;margin-bottom:3px;}<br>
   .hr3 {border-top:2px solid red;     margin-top:3px;margin-bottom:3px;}<br>
   ==========<br>
   Минусы анки - в их хранилище навалено в кучу и ничего хорошего нет, рейтинг туфта есть там платная 14т, но восторженые отзывы липа и много лишней ненужной инфы, не рекомендую. Удалить выученные неудобно (через меню-исключить) Файлы звук и картинки надо свои искать/делать и вставлять сложно и долго, встроеной озвучки нет, но можно через виджет гугл переводчика озвучить, но надо убирать *%~+= <br>
   <hr>
   <h2>Приложение QuizLet</h2>
   -МИНУСЫ - нет импорта-экспорта, надо на сайт идти и регится, там есть. Картинки только из колекции и мелкие. Нет интервального повтория. Хранилище скрыто! может там и есть что-то годное, но надо знать название чтобы искать! по (англ-рус) выйдет мало и не то, так что тоже не фонтан, отзыв не оставить, рейтинга нет, искать вслепую и все смотреть и выбирать надо год.<br>
   +ПЛЮСЫ - встроенная озвучка англ и рус, не надо свой звук тащить, можно сделать запись экрана, вытащить звук и слушать только те слова которые не знаешь. ну и можно по названию поделиться и будут искать и качать. <br>
   Как форматировать для неё не знаю, можно жирным выделить через **, может ещё что есть.
  </div>
 </div> 
</div>

<div role="tabpanel" class="tab-pane fade" id="tem1" >
 <div class="panel panel-primary">
  <div class="panel-heading">
   Исходный список слов
  </div>
  <div class="panel-body">
   <button type="button" onclick="loader1(1);">600b</button>
   <button type="button" onclick="loader1(2);">1500i</button>
   <button type="button" onclick="loader1(3);">1600p</button>
   <button type="button" onclick="loader1(4);">3200r</button>
   <button type="button" class="btn btn-success btn-lg" onclick="slash_hr();word_a();zvez_i();tran_b();">для Anki</button>
   <button type="button" class="btn btn-danger btn-lg" onclick="save_text();">Save</button>
   <button type="button" onclick="lat_rus();">Тест на смесь англ-рус</button>
   <button type="button" onclick="sec4();">Тест на 4 секции</button>
   <button type="button" onclick="zap_probel();">Всегда пробел после запятой (необязательно)</button>
   <button id="id_b300" type="button" onclick="obrez300();">вырезать 100(1) слов</button>

  </div>
  <div class="panel-body">
   <textarea id='id_text1' rows="10">
   Сюда загрузится полный список слов ||| Использование: anki.htm?500/600b.txt
   </textarea>
  </div>
 </div>
</div>

<div role="tabpanel" class="tab-pane fade" id="tem2">
 <div class="panel panel-primary">
  <div class="panel-heading">
   Удаление лишних слов и ФА для Анки
  </div>
  <div class="panel-body">
   <button type="button" class="btn btn-primary btn-lg" onclick="g_word=0;show_w();">Начало</button>
   ||
   <button type="button" onclick=""> список=<span id="id_list">?</span> номер слова=<span id="id_word">?</span> </button>
   ||
   <button type="button" class="btn btn-danger btn-lg" onclick="save_list();">Запомнить общий список</button>
   ||
   <button id="id_b0" type="button" class="btn btn-primary btn-lg" onclick="swipe_on();">Свайп вкл</button>
   <button id="id_b2" type="button" class="btn btn-success btn-lg" onclick="next_w();">Дальше</button>
   <button id="id_b1" type="button" class="btn btn-danger  btn-lg" onclick="del_w();">Удалить</button>
  </div>
 </div>

 <div class="panel panel-primary"> 
  <div class="panel panel-success">
   <h2> &nbsp;&nbsp;<b id="id_w">слово [транскрипция]</b> <span id="id_p" class="">перевод</span></h2>
  </div>
  <div class="panel-body">  
   <textarea id="id_a" rows="4" >fa</textarea>
   <textarea id="id_d" rows="4" >fa</textarea>
  </div>
<div id="id_info">инфо</div>
<button type="button" id="id_bbb"                 >Загрузить из файла список известных слов (текст с разделителем: ;,\t\n)</button><br>
<button type="button" onclick="load_list_js();"   >Загрузить список известных слов из english_words.js (рядом с index.htm)</button><br>
<button type="button" onclick="filter_list();"    >Удалить из общего списка все уже известные слова</button><br>
<button type="button" onclick="saveWordsToFile();">Сохранить на диск список известных слов (везде пригодится)</button><br>
  
 </div>
</div>
</div>



<script>
var g_fa='';//global
var g_word=0;//global
var g_ms=[];//global list
var rus1='йцукенгшщзхъфывапролджэячсмитьбюё';//33
var rus2=rus1.toUpperCase();
var lat1='qwertyuiopasdfghjklzxcvbnm';//26
var lat2=lat1.toUpperCase();

function log(s){console.log(s+'');}
function put_v(id,s){if(!s)s=' ';var d=document.getElementById(id);if(d)d.value=s+'';}
function get_v(id){var d=document.getElementById(id);if(d)return d.value+'';}
function put_h(id,s){if(!s)s=' ';var d=document.getElementById(id);if(d)d.innerHTML=s+'';}
function get_h(id){var d=document.getElementById(id);if(d)return d.innerHTML+'';}
function len(d){ return d.length;}
function info(t){put_h('id_info',t);}
function replace_all(s,a,b){var s0=s+'',a0=a+'', b0=b+'', ms;
 if(s0.indexOf(a0)>=0){ms=s0.split(a0);s0=ms.join(b0);}
 return s0;
}
function one_space(s){var i,out='',f=0,ss;
 for(i=0;i<len(s);i++){
   ss=s.charAt(i);
   if(ss==' '){if(f==1)continue;f=1;}
   else f=0;
   out+=ss;
 }
 return out.trim();
}
function loadScript(vPathScript, callback, arg1, arg2) { //new 2025
  return new Promise((resolve, reject) => {
    console.log('Загружаем скрипт=', vPathScript);
    const script = document.createElement('script');
    script.async = true;
    script.src = vPathScript;
    script.onload = () => {
      console.log('Скрипт загружен:', vPathScript);
      resolve();
      if (callback) {
        setTimeout(() => callback(arg1, arg2), 0);
      }
    };
    script.onerror = () => {
      console.error('Ошибка загрузки скрипта:', vPathScript);
      reject(new Error(`Ошибка загрузки скрипта: ${vPathScript}`));
    };
    document.head.appendChild(script);
  });
}
function save_text(file,text) {
 if(!file)file='new_anki.txt';
 if(!text)text=get_v('id_text1');
 const blob = new Blob([text], { type: 'text/plain' });
 const link = document.createElement('a');
 link.href = URL.createObjectURL(blob);
 link.download = file; // Имя файла
 document.body.appendChild(link);
 link.click();
 document.body.removeChild(link);
}
function put_txt(){var i,s,mm;
 mm=g_fa.split('\n');
 g_fa=''; for(i=0;i<mm.length;i++){s=mm[i].trim();if(s)if(s.charAt(0)!='#')g_fa+=s+'\n';}
 put_v('id_text1',g_fa);
}
function loader1(f){
 if(f==0)f=window.location.search.replace('?','');
 if(f==1)f="500/600b.txt";
 if(f==2)f="500/1500i.txt";
 if(f==3)f="500/1600p.txt";
 if(f==4)f="500/3200r.txt";
 if(f) loadScript(f,put_txt)
}
function lat_rus(){var i,n,k,w,ww,ss,s;
 var rus=rus1+rus2;
 var lat=lat1+lat2;
 ss=rus+lat; s=get_v('id_text1'); n=len(s); k=0; ww='';
 for(i=0;i<n;i++){
  w=s.charAt(i);
   if(k){
    if(ss.indexOf(w)<0){k=0;ww='';continue;}
    if(rus.indexOf(w)>=0)if(k==1)alert(i+'/?'+ww+w);
    if(lat.indexOf(w)>=0)if(k==2)alert(i+'/??'+ww+w);
   }
   if(k==0){if(lat.indexOf(w)>=0)k=1;if(rus.indexOf(w)>=0)k=2;}
   if(k)ww+=w;
 }
 alert('ok');
}
function sec4(){var ms=[],n=0,k=0,dd=[],v=0,mm=[],x='';
 var s=get_v('id_text1');
 var s173=String.fromCharCode(173);
 if(s.indexOf(s173)>=0)alert(173);
 ms=s.split('\n');
 n=len(ms);
  for(k=0;k<n;k++){
   s=ms[k];
   if(s.charAt(0)=='#')continue;
   if(s=='')continue;
   dd=s.split('|');
   if(len(dd)!=4)alert(s);
   dd=dd[0].split('[');
   x='0'+dd[0];
   if(mm[x])alert(s);else mm[x]=1;
   v++;
  }
  alert('vsego='+v);
}
function zap_probel(){
 s=get_v('id_text1');
 ms=s.split('\n');s='';
 n=len(ms);
 for(k=0;k<n;k++){
  s=ms[k];
  if(s.charAt(0)=='#')continue;
  if(s=='')continue;
  s=s.replace('[',' ['); //1raz 
  dd=s.split('|');
  s=dd[2];s=replace_all(s,',',', ');
  ms[k]=dd[0]+'|'+dd[1]+'|'+s+'|'+dd[3];
 }
 s=ms.join('\n');
 s=one_space(s);
 put_v('id_text1',s);
 alert('ok');
}
function zv_i(s){var n,k,ww,i,w,ss;//*слова окружить тегом i
 var rus=rus1+rus2+'-';s=s+' ';
 n=len(s);k=0;ww='';
 for(i=0;i<n;i++){
  w=s.charAt(i);
  if(k==1)if(rus.indexOf(w)<0){k=0;w='</i>'+w;}
  if(k==0)if(w=='*'){w='<i>*';k=1;}
  ww+=w;
 }
 return ww.trim();
}
function zagl_b(s){var n,k,ww,i,w,ss,f//заглавные рус.буквы окружаем тегом b
 s=s+' ';n=len(s);k=0;ww='';f=0;
 for(i=0;i<n;i++){
  w=s.charAt(i);
  if(f==0)if(w=='~')f=1;
  if(k==1)if(rus2.indexOf(w)<0){k=0;if(f==0)w='</b>'+w;}//ниже не найдет такое
  if(k==0)if(rus2.indexOf(w)>=0){if(f==0)w='<b>'+w;k=1;}
  if(f==1){if(w==')')f=0;if(w==' ')f=0;}
  ww+=w;
 }
 return ww.trim();
}
//slash_hr();word_a();zvez_i();tran_b()
function slash_hr(){var s,ms,n,k,dd,out;
 s=get_v('id_text1');
 ms=s.split('\n');
 n=len(ms);out='';
 for(k=0;k<n;k++){
  s=ms[k];
  if(s.charAt(0)=='#')continue;  if(s=='')continue;
  s=replace_all(s,'//','<hr class="hr2">');
  
  dd=s.split('|');
  dd[2]=replace_all(dd[2],'/', '<hr class="hr1">');
  dd[3]=replace_all(dd[3],'/', ' /');
  s=dd.join('|');
  s=s.replace('[',' ['); //1raz 
  out+=s+'\n';
 }
 s=one_space(out);out='';
 ms=s.split('\n');s='';
 n=len(ms);
 for(k=0;k<n;k++){
  s=ms[k];s=zv_i(s);s='<a>'+s.replace(' [','</a> [');
  dd=s.split('|'); if(dd.length!=4)alert(s);
  dd[0]=dd[0].replace(' [',' <b>[');
  dd[0]=dd[0].replace('] ',']</b> ');
  
  s=dd[2];
  ms[k]=''+dd[0]+'|'+dd[1]+'|'+zagl_b(s)+'|'+dd[3]+'';
 }
 s=ms.join('\n');ms=[];
 s=replace_all(s,'<i>*</i>','*');
 s=replace_all(s,' \n','\n');
 s=one_space(s);
 put_v('id_text1',s);
 alert('ok');
}

document.addEventListener('touchstart',handleTouchStart,false);// Вешаем на прикосновение
document.addEventListener('touchmove',handleTouchMove,false);// на движение пальцем по экрану

var xDown = null, yDown = null, g_busy=0; g_swipe=0;//global var
function handleTouchStart(evt){xDown=evt.touches[0].clientX; yDown=evt.touches[0].clientY;}
function handleTouchMove(evt){var xUp,yUp,xDiff,yDiff;
 if(g_busy)return;g_busy=1;//занято
 if(!xDown || !yDown){g_busy=0; return;}
 xUp=evt.touches[0].clientX; yUp=evt.touches[0].clientY;
 xDiff=xDown - xUp; yDiff=yDown - yUp;
 if(Math.abs(xDiff) > Math.abs(yDiff)){
  if(xDiff > 5){document.title="==NEXT==>>";if(g_swipe)setTimeout(next_w,200);} // left swipe
  if(xDiff < -5){document.title="<<==DEL==";if(g_swipe)setTimeout(del_w,200);} // right swipe
 }
 xDown = null; yDown = null; g_busy=0; return;
}
function swipe_on(){
 if(g_swipe){g_swipe=0;put_h('id_b0','Свайп вкл');}
 else {g_swipe=1;put_h('id_b0','Свайп ВЫКЛ');}
}
function cards(){var i,s,dd;
 s=get_v('id_text1');dd=s.split('\n');g_word=0;
 g_ms=[];for(i=0;i<dd.length;i++){if(4==len(dd[i].split('|')))g_ms.push(dd[i]);}
 show_w();
}
function show_w(){var s,dd;
 s=''+g_ms[g_word];
 dd=s.split('|');
 put_h('id_w',dd[0]);
 put_h('id_p',dd[1]);
 put_v('id_a',dd[2]);
 put_v('id_d',dd[3]);
 put_h('id_list',g_ms.length);
 put_h('id_word',g_word+1);
}
function next_w(){
 g_ms[g_word]= get_h('id_w')+'|'+get_h('id_p')+'|'+get_v('id_a')+'|'+get_v('id_d');
 g_word++;
 if(g_word==len(g_ms)){alert('Конец списка');g_word=0;}
 show_w();
}
function del_w(){
 var w=g_ms[g_word].split(' ')[0];addKnownWord(w);
 g_ms.splice(g_word, 1);//del g_ms[g_word]
 if(g_word==len(g_ms)){alert('Конец списка');g_word=0;}
 show_w();
}
function save_list(){
 put_v('id_text1',g_ms.join('\n'));
 document.getElementById('id_spisok').click();
}

var g_300=1;
var g_len=100;
function obrez300(){var mm,n;
 mm=g_fa.split('\n');n=(g_300-1)*g_len;
 mm=mm.slice(n,n+g_len);g_300++;if(len(mm)==0)g_300=1;
 put_h('id_b300','Вырезать 100('+g_300+') слов');
 put_v('id_text1',mm.join('\n'));
}
// либа для работы со списками известных слов
// Функция для получения списка известных слов из localStorage
function save_s_to_Loc(name_el,s){
 try {localStorage.setItem(name_el,s);}
 catch(e) { if (e == QUOTA_EXCEEDED_ERR) alert('limit localStorage2');}
}
function load_s_from_Loc(name_el){
    var v=localStorage.getItem(name_el);
    if(v) return v;
    else return '';
}

function getKnownWords() {
 const storedWords = localStorage.getItem('knownEnglishWords');
 return storedWords ? storedWords.split('\n') : [];
}
// Функция для сохранения списка известных слов в localStorage
function saveKnownWords(words) {
 try {localStorage.setItem('knownEnglishWords', words.join('\n'));}
 catch(e) { alert('error'); if (e == QUOTA_EXCEEDED_ERR) alert('limit localStorage?');}
 return words.length;
}
// Функция для добавления слова в список известных слов
function addKnownWord(w){
 if(!w)return 0;w=w+'';w=w.trim();if(w=='')return 0;
 w=w.toLowerCase();w=replace_all(w,' ','-');
 var words = getKnownWords();
 if (!words.includes(w)) {
  words.push(w);
  saveKnownWords(words);
  info('известных слов='+words.length);
 } else info('уже есть');
}
// Функция для удаления слова из списка известных слов
function delKnownWord(word) {
 var words = getKnownWords();
 if (words.includes(word)) {
  words=words.filter(w => w !== word);
  saveKnownWords(words);
  return 1;
 } else return 0;
}
// Функция для создания ссылки и обработки загрузки файла
function upload_file(){
  
  // Скрытый input для выбора файла
  const fileInput = document.createElement("input");
  fileInput.type = "file";
  fileInput.style.display = "none";

  // При клике по ссылке — кликаем по input
  document.getElementById('id_bbb').addEventListener("click", (e) => {
    e.preventDefault();
    fileInput.click();
  });

  // Обработка выбранного файла
  fileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onerror = function(error){info('Ошибка при чтении файла:'+error);};
    reader.onload = function(evt){var v='',i=0,dd=[],mm=[];
	  v=evt.target.result+'';
      v=v.replace('g_words=`','');v=v.replace('`;','');
      v=replace_all(v,', ',',');
      v=replace_all(v,',','\n');
      v=replace_all(v,'; ',';');
      v=replace_all(v,';','\n');
      v=replace_all(v,'\t','\n');
      v=v.toLowerCase(); //все слова маленькими буквами, для правильного поиска
      mm=v.split('\n');
      for(i=0;i<mm.length;i++){
       v=mm[i].trim();
       v=replace_all(v,' ','-'); //составные через дефис
       if(v)if(!dd.includes(v))dd.push(v);
      } 
      saveKnownWords(dd);
      info('ok='+dd.length);
    };
    reader.readAsText(file, "UTF-8");
  });

  // Добавляем элементы на страницу
  document.body.appendChild(fileInput);
}
function old_loadWordsFromFile() {
    const fileInput = document.getElementById('id_file');
    if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
      alert('Пожалуйста, выберите файл.');
      return 0;
    }
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(event) {var v='',i=0,dd=[],mm=[];
      v = event.target.result;
      v=v.replace('g_words=`','');v=v.replace('`;','');
      v=replace_all(v,', ',',');
      v=replace_all(v,',','\n');
      v=replace_all(v,'; ',';');
      v=replace_all(v,';','\n');
      v=replace_all(v,'\t','\n');
      v=v.toLowerCase(); //все слова маленькими буквами, для правильного поиска
      mm=v.split('\n');
      for(i=0;i<mm.length;i++){
       v=mm[i].trim();
       v=replace_all(v,' ','-'); //составные через дефис
       if(v)if(!dd.includes(v))dd.push(v);
      } 
      saveKnownWords(dd);
      info('ok='+dd.length);
    };
    reader.onerror = function(error) {
       info('Ошибка при чтении файла:'+error);
    };
    reader.readAsText(file);
    return 1;
}

// Функция для сохранения списка известных слов в текстовый файл (скачивание файла браузером)
function saveWordsToFile(filename = 'english_words.js') {
 var words=getKnownWords();
 const text = 'g_words=`\n'+words.join('\n')+'\n`;';
 const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
 const link = document.createElement('a');
 link.href = URL.createObjectURL(blob);
 link.download = filename;
 document.body.appendChild(link);
 link.click();
 document.body.removeChild(link);
 URL.revokeObjectURL(link.href);
}

// Функция для фильтрации списка слов, оставляя только неизвестные
function filterUnknownWords(allWords) {
 const knownWords = getKnownWords();
 return allWords.filter(word => !knownWords.includes(word));
}

async function load_list_js() {
  try {
    await loadScript('english_words.js');
    if (window.g_words) {
	  var mm=g_words.split('\n');g_words='';
	  mm=mm.map(w => w.trim()).filter(w => w !== '');
      saveKnownWords(mm);
      info('ok='+mm.length);
    } else {
      info('Переменная g_words не найдена');
    }
  } catch (error) {
    info('Произошла ошибка при загрузке или обработке скрипта:'+error);
  }
}
function filter_list(){var i,s,dd,uw,k,w; //чистим общий список от известных слов
 s=get_v('id_text1');dd=s.split('\n');g_word=0;uw=getKnownWords();
 g_ms=[];for(i=0;i<dd.length;i++){
	 s=dd[i];k=len(s.split('|'));w=s.split(' ')[0];
	 if(k==4)if(!uw.includes(w))g_ms.push(s);}
 show_w();
}


loader1(0);upload_file();

// XingSoft*2025 Для удаления лишних слов и ФА и форматирование для импорта в АнкиДроид
// Расчитано на Экран 1280 х 800 , Остальным неповезло :) Сами размеры подгоняйте
</script>
</body>
